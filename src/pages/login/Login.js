import $ from 'jquery';
import React from 'react';
import { Control } from 'react-keeper';

import { login } from '../../api';
import renderObj from '../../common/const';

import './Login.css';

class Login extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasMessage: false,
      message: ''
    }
  }

  login() {
    let phone = $('.username').val();
    let password = $('.password').val();
    login.login(phone, password)
      .then(res => {
        if (res.status == 200) {
          if (res.data && res.data.account) {
            renderObj.uid = res.data.account.id;
            Control.go('/home');
          } else {
            this.setState({
              hasMessage: true,
              message: '登录失败'
            });
            setTimeout(() => {
              this.setState({
                hasMessage: false
              })
            } ,3000);
          }
        }
      });
  }

  render() {
    return (
      <div className="login-container">
        <svg className="logo" viewBox="0 0 1024 1024" width="150" height="150">
          <path d="M601.088 1011.712c-72.704 0-128.512-34.304-142.848-87.04-1.536-5.12-2.56-10.752-3.072-17.92l2.048-11.776-301.056-0.512c-53.248 0-100.864-45.568-115.712-111.104-11.776-51.712 3.072-107.008 36.864-137.728 3.072-3.072 7.168-4.608 11.264-4.608h162.304l-5.632-13.824c-4.608-11.776-10.24-23.552-16.896-34.816l-174.08-258.048c-14.336-23.04-25.6-50.688-32.768-81.92-22.528-99.84 19.968-202.24 96.256-232.96 5.12-1.024 29.184-5.632 37.376-6.656 0.512 0 1.536-0.512 2.048-0.512h505.856c53.76 0.512 100.352 45.568 114.688 111.616 11.776 51.712-3.072 107.008-36.864 137.728-3.072 3.072-7.168 4.608-11.264 4.608h-162.304l5.12 13.824c5.12 13.824 11.264 26.112 17.92 36.352L768 579.072v-229.888c0-8.704 7.168-15.872 15.872-15.872 7.68 0 13.824 5.632 14.848 13.312v0.512l1.536 5.632 0.512 0.512c5.632 18.944 29.696 40.448 67.584 72.192 41.984 34.816 94.208 78.336 121.856 138.752 31.744 69.632 23.04 146.944-26.624 235.52-2.56 4.608-8.192 7.68-13.824 7.68-2.048 0-4.608-0.512-7.68-2.048-4.096-2.56-6.144-6.144-7.168-11.264 0-1.024 0-2.56-1.024-4.608-5.12-40.448-42.496-137.728-90.112-157.696-2.56-1.024-8.192-3.584-15.872-3.584-6.656 0-12.8 1.536-18.944 4.608h-0.512l-7.68 4.608v218.624c0.512 28.16-10.24 55.296-30.72 79.872-26.624 31.232-65.536 54.784-109.568 66.56-19.456 6.144-39.936 9.216-59.392 9.216z m54.272-235.52c-17.92 0-35.84 2.56-52.736 7.168-46.592 12.288-86.016 39.936-105.472 73.216-7.68 13.824-15.872 34.816-9.728 57.856 9.728 37.376 56.832 63.488 113.664 63.488 15.872 0 33.28-2.56 51.2-7.168 38.4-10.24 72.704-30.72 93.184-56.32 20.992-26.112 28.16-51.2 22.016-75.264-10.24-37.376-55.296-62.976-112.128-62.976z m-521.728-726.528l-1.024 0.512c-48.128 18.944-81.92 80.896-81.92 150.528 0 15.36 1.536 30.208 4.608 44.544 6.144 26.624 15.36 50.176 28.672 70.656l173.568 258.048c14.336 23.552 25.6 51.2 32.256 80.896 4.096 17.408 5.632 35.328 5.632 53.76 0 51.2-16.896 99.328-48.128 136.192l-14.336 16.896h228.864l2.56-6.144 1.536-3.584c1.536-3.072 2.56-6.144 4.608-8.704 24.064-41.472 69.12-73.216 124.416-88.064 20.48-5.632 40.96-8.192 60.928-8.192 33.792 0 65.024 7.68 90.624 22.016l17.408 11.264 5.12-22.016c0-0.512 0.512-1.024 0.512-2.048l0.512-2.56V666.112l-0.512-1.024c-5.632-24.576-19.968-54.272-31.232-72.704l-173.568-258.048c-10.24-16.384-18.944-35.84-26.624-61.44l-2.048-7.168h-312.832c-7.168 0-12.8-4.096-15.36-10.24-2.56-6.656-1.024-13.824 4.096-18.432 25.088-23.04 35.84-66.56 27.136-105.984-11.264-49.664-44.032-83.968-81.408-85.504h-1.024l-23.04 4.096z m-38.912 627.2c-15.36 18.432-24.576 44.032-24.576 70.144 0 11.264 1.024 19.968 3.072 28.16 11.264 50.176 45.568 84.992 83.456 84.992 1.024 0 1.536 0 20.992-3.584h1.024l1.024-0.512c54.784-21.504 89.088-96.256 80.384-173.568l-1.024-9.216h-160.768l-3.584 3.584z m735.232-80.896c9.216 0 17.92 2.048 26.112 5.12 41.472 17.408 71.168 72.704 84.48 104.448l17.408 41.472 11.264-44.032c33.792-124.928-50.688-195.584-118.784-252.416l-0.512-0.512c-7.168-6.144-13.824-11.264-19.456-16.384l-3.584-3.072-25.6-20.992v190.464l17.408-3.072h1.024c3.584-0.512 7.168-1.024 10.24-1.024z m-278.016-364.032h170.496l3.072-3.584c15.36-18.432 24.576-44.032 24.576-70.144 0-9.728-1.024-18.944-3.584-28.16-10.752-49.664-44.544-84.992-81.92-85.504h-434.688l11.776 16.384c14.848 20.48 24.576 40.96 29.184 61.952 2.56 12.288 4.096 23.552 4.096 34.816 0 20.48-4.096 41.472-11.776 59.904l-6.144 14.336h294.912z" fill="#e31436"></path>
          <path d="M370.176 595.456c-5.632 0-10.24-4.608-10.24-10.24s4.608-10.24 10.24-10.24h260.096c5.632 0 10.24 4.608 10.24 10.24s-4.608 10.24-10.24 10.24h-260.096z m-59.904-87.552c-5.632 0-10.24-4.608-10.24-10.24s4.608-10.24 10.24-10.24h260.096c5.632 0 10.24 4.608 10.24 10.24s-4.608 10.24-10.24 10.24h-260.096z m-55.808-87.04c-5.632 0-10.24-4.608-10.24-10.24s4.608-10.24 10.24-10.24h260.096c5.632 0 10.24 4.608 10.24 10.24 0 5.12-5.12 10.24-10.24 10.24h-260.096z" fill="#e31436"></path>
        </svg>
        <div className="input-container">
          <div class="m-item">
            <div class="u-label">手机号码<span class="u-must">*</span></div>
            <input class="u-input username"
                type="text"
                placeholder="请输入注册过的手机号码"/>
          </div>
          <div class="m-item">
            <div class="u-label">密码<span class="u-must">*</span></div>
            <input class="u-input password"
                type="password"
                placeholder="请输入密码"/>
          </div>
          <input className="login-btn" type="button" value="登录" onClick={e => this.login(e)} />
        </div>
        {
          this.state.hasMessage ? <div className="login-notify">{this.state.message}</div> : ''
        }
      </div>
    );
  }
}

export default Login;